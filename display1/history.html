<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4ì»· ë§Œí™” ìŠ¤íƒ€ì¼ ê°¤ëŸ¬ë¦¬</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap");

      body {
        background-color: #f8f4e9;
        background-image: url("https://d2w79zoxq32d33.cloudfront.net/html/background.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        min-height: 100vh;
        margin: 0;
        font-family: "Noto Sans KR", sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0;
        overflow-x: hidden;
      }

      .comic-title {
        font-family: "Comic Neue", cursive;
        font-size: 2.5rem;
        color: #333;
        text-align: center;
        margin: 15px 0;
        background-color: #fff;
        padding: 10px 30px;
        border-radius: 50px;
        border: 3px solid #000;
        box-shadow: 5px 5px 0 #000;
        transform: rotate(-2deg);
      }

      .comic-container {
        max-width: 95vw;
        width: 95%;
        background-color: #fff;
        border: 5px solid #000;
        border-radius: 15px;
        padding: 15px;
        box-shadow: 10px 10px 0 #000;
        margin-bottom: 20px;
      }

      .comic-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(2, auto);
        gap: 30px;
        padding: 10px;
        max-width: 100%;
        margin: 0;
      }

      .comic-panel {
        position: relative;
        width: 100%;
        height: 0;
        padding-bottom: 100%;
        background-color: #fff;
        border: 5px solid #000;
        border-radius: 5px;
        overflow: hidden;
        box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease;
      }

      .comic-panel:hover {
        transform: scale(1.02);
        z-index: 10;
      }

      .comic-panel img,
      .comic-panel video {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: cover;
        top: 0;
        left: 0;
      }

      /* íŒ¨ë„ ë²ˆí˜¸ ìŠ¤íƒ€ì¼ ì œê±° */

      .panel-caption {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(255, 255, 255, 0.8);
        padding: 8px;
        font-family: "Comic Neue", cursive;
        font-weight: bold;
        text-align: center;
        border-top: 3px solid #000;
      }

      /* ë§í’ì„  ìŠ¤íƒ€ì¼ */
      .speech-bubble {
        position: absolute;
        background-color: #fff;
        border: 3px solid #000;
        border-radius: 20px;
        padding: 8px 15px;
        font-family: "Comic Neue", cursive;
        font-weight: bold;
        font-size: 1.1rem;
        max-width: 70%;
        text-align: center;
        box-shadow: 3px 3px 0 #000;
        z-index: 5;
      }

      .speech-bubble::after {
        content: "";
        position: absolute;
        border: 15px solid transparent;
        border-top-color: #fff;
        border-bottom: 0;
        bottom: -12px;
        left: 50%;
        margin-left: -15px;
        z-index: 5;
      }

      .speech-bubble::before {
        content: "";
        position: absolute;
        border: 18px solid transparent;
        border-top-color: #000;
        border-bottom: 0;
        bottom: -18px;
        left: 50%;
        margin-left: -18px;
        z-index: 4;
      }

      .panel-1-bubble {
        top: 20px;
        left: 15px;
        background-color: #ffff99;
      }

      .panel-2-bubble {
        top: 20px;
        right: 15px;
        background-color: #ff9999;
      }

      .panel-3-bubble {
        top: 20px;
        left: 15px;
        background-color: #99ff99;
      }

      .panel-4-bubble {
        top: 20px;
        right: 15px;
        background-color: #9999ff;
      }

      /* íš¨ê³¼ìŒ ìŠ¤íƒ€ì¼ */
      .sound-effect {
        position: absolute;
        font-family: "Comic Neue", cursive;
        font-weight: bold;
        font-size: 2rem;
        color: #ff5252;
        text-shadow: 2px 2px 0 #000;
        z-index: 5;
        transform: rotate(-10deg);
      }

      .panel-1-effect {
        top: 65%;
        right: 20px;
      }

      .panel-2-effect {
        top: 60%;
        left: 20px;
      }

      .panel-3-effect {
        top: 65%;
        right: 25px;
      }

      .panel-4-effect {
        top: 60%;
        left: 25px;
      }

      .text-content {
        background-color: #fff;
        border: 5px solid #000;
        border-radius: 15px;
        padding: 20px;
        font-family: "Noto Sans KR", sans-serif;
        line-height: 1.6;
        max-width: 95vw;
        width: 95%;
        margin-top: 20px;
        margin-bottom: 20px;
        box-shadow: 10px 10px 0 #000;
        position: relative;
      }

      .text-content::before {
        content: "";
        position: absolute;
        width: 30px;
        height: 30px;
        background-color: #fff;
        border-left: 5px solid #000;
        border-top: 5px solid #000;
        top: -20px;
        left: 50%;
        transform: translateX(-50%) rotate(45deg);
      }

      .text-content h4 {
        margin: 0 0 10px 0;
        color: #333;
        font-size: 1.5rem;
        border-bottom: 3px dashed #ff5252;
        padding-bottom: 5px;
        display: inline-block;
      }

      .text-content ul {
        margin: 0;
        padding-left: 20px;
        list-style-type: none;
      }

      .text-content ul li {
        position: relative;
        padding-left: 25px;
        margin-bottom: 8px;
      }

      .text-content ul li::before {
        content: "âœ¦";
        position: absolute;
        left: 0;
        color: #ff5252;
        font-weight: bold;
      }

      .emotion-highlight {
        display: inline-block;
        background-color: #ffff00;
        padding: 3px 8px;
        border-radius: 10px;
        font-weight: bold;
        transform: rotate(-2deg);
        margin: 0 2px;
        border: 2px solid #000;
        box-shadow: 2px 2px 0 #000;
      }

      .situation-box {
        background-color: #e6f7ff;
        border: 3px solid #000;
        border-radius: 10px;
        padding: 10px 15px;
        margin: 10px 0;
        box-shadow: 5px 5px 0 #000;
      }

      .text-content pre {
        background-color: #fffc9e;
        padding: 15px;
        border-radius: 10px;
        margin: 15px 0;
        border: 3px solid #000;
        font-family: "Noto Sans KR", sans-serif;
        white-space: pre-wrap;
      }

      .thought-bubble {
        position: absolute;
        width: 60px;
        height: 60px;
        background-color: #fff;
        border: 3px solid #000;
        border-radius: 50%;
        top: -70px;
        right: 30px;
        z-index: 5;
      }

      .thought-bubble::before,
      .thought-bubble::after {
        content: "";
        position: absolute;
        background-color: #fff;
        border: 3px solid #000;
        border-radius: 50%;
      }

      .thought-bubble::before {
        width: 30px;
        height: 30px;
        bottom: -15px;
        right: 10px;
      }

      .thought-bubble::after {
        width: 15px;
        height: 15px;
        bottom: -25px;
        right: 0;
      }

      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
        width: 100%;
      }

      .loading-spinner {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #ff5252;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error-message {
        background-color: #ffdddd;
        color: #ff0000;
        padding: 15px;
        border-radius: 10px;
        margin: 20px 0;
        border: 3px solid #ff0000;
        font-weight: bold;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1 class="comic-title">ì˜¤ëŠ˜ì˜ ìš”ë¦¬ ì´ì•¼ê¸°</h1>

    <div class="comic-container">
      <div id="comicGrid" class="comic-grid">
        <div class="loading">
          <div class="loading-spinner"></div>
        </div>
      </div>
    </div>

    <div id="textContent" class="text-content">
      <div class="thought-bubble"></div>
      <div class="loading">
        <div class="loading-spinner"></div>
      </div>
    </div>

    <script>
      // DynamoDBì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ ì‹œë®¬ë ˆì´ì…˜
      async function fetchDataFromDynamoDB() {
        try {
          // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì—¬ê¸°ì— AWS SDKë¥¼ ì‚¬ìš©í•˜ì—¬ DynamoDBì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤
          // ì§€ê¸ˆì€ ì£¼ì–´ì§„ ì˜ˆì œ ë°ì´í„°ë¥¼ ì‚¬ìš©
          return {
            id: "user1234",
            episode:
              "ì–´ëŠ ë‚  ë™ë£Œë“¤ê³¼ í•¨ê»˜ ì»¤í”¼ë¥¼ ë§ˆì‹œë˜ ì¤‘, ìƒˆë¡œìš´ ì•„ì´ë””ì–´ì— ëŒ€í•´ ì—´ë¤ í† ë¡ ì„ ë²Œì˜€ìŠµë‹ˆë‹¤. ê·¸ëŠ” ìì‹ ì˜ ì•„ì´ë””ì–´ë¥¼ ì„¤ëª…í•˜ë©° ì—´ì •ì ìœ¼ë¡œ ì†ì§“ì„ í•˜ì˜€ê³ , ê²°êµ­ ê·¸ì˜ ì•„ì´ë””ì–´ê°€ ì±„íƒë˜ì—ˆìŠµë‹ˆë‹¤. :ì§ :",
            media_list: [
              "https://d3dybxg1g4fwkj.cloudfront.net/multi_shot_automated_2/120_Doenjang_Jjigae_1_ingredients_5_20250414_202423_20250506_114301/dygsdxd00vro/shot_0001.mp4",
              "https://d2w79zoxq32d33.cloudfront.net/familiar-15-menus2/120_Doenjang_Jjigae_2_preparation_3_20250414_202518.png",
              "https://d2w79zoxq32d33.cloudfront.net/familiar-15-menus2/120_Doenjang_Jjigae_3_cooking_3_20250414_202622.png",
              "https://d3dybxg1g4fwkj.cloudfront.net/multi_shot_automated_2/120_Doenjang_Jjigae_4_plating_1_20250414_202722_20250506_115124/sutvi1pozw4w/shot_0005.mp4",
            ],
            persona:
              "ì´ ì¸ë¬¼ì€ 30ëŒ€ í›„ë°˜ì˜ ë‚¨ì„±ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ì•ˆê²½ì„ ì“°ê³  ìˆì–´ ì§€ì ì¸ ì´ë¯¸ì§€ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, ì›ƒëŠ” í‘œì •ìœ¼ë¡œ ë³´ì•„ ì¹œê·¼í•˜ê³  ì¾Œí™œí•œ ì„±ê²©ì„ ê°€ì§€ê³  ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ì•„ë§ˆë„ í•™ë¬¸ì ì¸ ë¶„ì•¼ì—ì„œ ì¼í•˜ëŠ” ì§ì—…ì„ ê°€ì§€ê³  ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.",
            questions: [
              {
                question:
                  "ì´ë²ˆì— ë™ë£Œë“¤ê³¼ í•¨ê»˜ ì—´ë¬ë¡œ í† ë¡ í•œ ì•„ì´ë””ì–´ì— ëŒ€í•´ ìƒê°í•´ ë³´ì•˜ì„ ë•Œ, ë‹¹ì‹ ì´ ê°€ì¥ ì¢‹ì•„í•˜ëŠ” í† ë¡  ì£¼ì œëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                answer: "ê³¼í•™ ê¸°ìˆ  ê´€ë ¨ ì£¼ì œ",
              },
              {
                question:
                  "ë™ë£Œë“¤ê³¼ ì•„ì´ë””ì–´ë¥¼ í† ë¡ í•˜ë©° ì—´ì •ì ìœ¼ë¡œ ì†ì§“ì„ í•˜ë˜ ëª¨ìŠµì„ ë³´ê³ , ë‹¹ì‹ ì€ ì–´ë–¤ í™œë™ì„ í†µí•´ ìì‹ ì˜ ìƒê°ì„ í‘œí˜„í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•˜ë‚˜ìš”?",
                answer:
                  "ì˜ˆìˆ ì ì¸ í‘œí˜„ì„ í†µí•´ ìì‹ ì˜ ìƒê°ì„ ì „ë‹¬í•˜ëŠ” ê²ƒ, ì˜ˆë¥¼ ë“¤ì–´ ê·¸ë¦¼ì´ë‚˜ ìŒì•…",
              },
              {
                question:
                  "ì´ ì¸ë¬¼ì´ ì·¨ë¯¸ í™œë™ìœ¼ë¡œ ê°€ì¥ ì¦ê¸°ëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”? ì•„ë˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.",
                answer: "ì»¤í”¼ìˆì—ì„œ ë‹¤ì–‘í•œ ìŒë£Œë¥¼ ì‹œìŒí•˜ê¸°",
              },
            ],
            recommend: `
#### ì˜¤ëŠ˜ì˜ ë‹¹ì‹ ì€?
- **í˜„ì¬ ê°ì •**: ì„±ì·¨ê°, ì—´ì •, ê¸°ì¨
- **ìƒí™©**: ë™ë£Œë“¤ê³¼ì˜ í† ë¡ ì—ì„œ ì•„ì´ë””ì–´ê°€ ì±„íƒë˜ì–´ ì„±ê³µì ì¸ ìˆœê°„ì„ ê²½í—˜í•¨
#### ì¶”ì²œ ìŒì‹
\`\`\`txt
ê³¼í•™ì  í˜¸ê¸°ì‹¬ê³¼ ì˜ˆìˆ ì  ê°ì„±ì´ ê³µì¡´í•˜ëŠ” ë‹¹ì‹ ì—ê²Œ, ì„±ì·¨ì˜ ê¸°ì¨ì„ ë”ìš± í’ì„±í•˜ê²Œ í•´ì¤„ ìƒ‰ê°ì´ í™”ë ¤í•˜ê³  ë‹¤ì–‘í•œ ë§›ì˜ ì¡°í™”ê°€ ë‹ë³´ì´ëŠ” í•œì‹ ìš”ë¦¬
\`\`\`
#### ì¶”ì²œ ì´ìœ 
ì˜¤ëŠ˜ ë‹¹ì‹ ì€ ë§ˆì¹˜ ì™„ë²½í•œ ì»¤í”¼ í•œ ì”ì²˜ëŸ¼ ê· í˜• ì¡íŒ í•˜ë£¨ë¥¼ ë³´ë‚´ì…¨êµ°ìš”! ê³¼í•™ ê¸°ìˆ ì— ëŒ€í•œ ì—´ì •ê³¼ ì˜ˆìˆ ì  ê°ì„±ì„ ëª¨ë‘ ê°–ì¶˜ ë‹¹ì‹ ì˜ ì•„ì´ë””ì–´ê°€ ë¹›ì„ ë°œí•œ íŠ¹ë³„í•œ ë‚ ì´ë‹ˆ, ê·¸ ì„±ì·¨ê°ì„ ë”ìš± í’ì„±í•˜ê²Œ í•´ì¤„ ìŒì‹ì´ í•„ìš”í•©ë‹ˆë‹¤.
ë§ˆì¹˜ ë‹¤ì–‘í•œ ì»¤í”¼ë¥¼ ìŒë¯¸í•˜ë“¯ ì—¬ëŸ¬ ë§›ì´ ì¡°í™”ë¡­ê²Œ ì–´ìš°ëŸ¬ì§„ í•œì‹ì´ ì–´ë–¨ê¹Œìš”? ìƒ‰ê°ì´ í™”ë ¤í•œ ìŒì‹ì€ ë‹¹ì‹ ì˜ ì˜ˆìˆ ì  ê°ì„±ì„ ë§Œì¡±ì‹œí‚¤ê³ , ë‹¤ì±„ë¡œìš´ ë§›ì˜ ì¡°í•©ì€ ê³¼í•™ì  í˜¸ê¸°ì‹¬ì„ ìê·¹í•  ê±°ì˜ˆìš”. ì„±ê³µì˜ ì§œë¦¿í•¨ì„ ì…ì•ˆ ê°€ë“ ëŠë¼ë©°, ì˜¤ëŠ˜ì˜ ê¸°ì¨ì„ ë”ìš± íŠ¹ë³„í•˜ê²Œ ê¸°ë…í•´ë³´ì„¸ìš”. ë‹¹ì‹ ì˜ ë¹›ë‚˜ëŠ” ì•„ì´ë””ì–´ì²˜ëŸ¼, ì˜¤ëŠ˜ ì €ë…ë„ ë¹›ë‚˜ê¸¸ ë°”ëë‹ˆë‹¤!
`,
            recommend_id: "120",
            result:
              "# ì™•ì„±ì‹ë‹¹ì˜ ëœì¥ì°Œê°œ, ë‹¹ì‹ ì˜ ì—´ì •ì ì¸ í† ë¡  í›„ì— ë”± ë§ëŠ” ì„ íƒì´ë„¤ìš”! ğŸŒŸ\n\nì•ˆë…•í•˜ì„¸ìš”, ì§€ì ì´ë©´ì„œë„ ì¹œê·¼í•œ ë§¤ë ¥ì„ ê°€ì§„ ë‹¹ì‹ ! ì—´ì •ì ì¸ í† ë¡  ëì— ì•„ì´ë””ì–´ê°€ ì±„íƒë˜ì—ˆë‹¤ë‹ˆ ì •ë§ ì¶•í•˜ë“œë ¤ìš”! ğŸ‘ ê·¸ ì„±ì·¨ê°ì„ ë”ìš± íŠ¹ë³„í•˜ê²Œ ë§Œë“¤ì–´ì¤„ ìŒì‹ì„ ì†Œê°œí•´ë“œë¦´ê²Œìš”.",
          };
        } catch (error) {
          console.error("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:", error);
          throw error;
        }
      }

      // ë§í’ì„  í…ìŠ¤íŠ¸ ì„¤ì •
      const speechBubbleTexts = [
        "ì¬ë£Œ ì¤€ë¹„ ì™„ë£Œ!",
        "ì–‘ë…ì´ í•µì‹¬ì´ì§€!",
        "ì´ë ‡ê²Œ ë“ì—¬ì•¼ ë§›ìˆì–´~",
        "ì™„ì„±! ë§›ìˆê²Œ ë“œì„¸ìš”!",
      ];

      // íš¨ê³¼ìŒ í…ìŠ¤íŠ¸ ì„¤ì •
      const soundEffectTexts = ["íƒ! íƒ!", "ì™€ê¸€ì™€ê¸€!", "ë³´ê¸€ë³´ê¸€~", "ì§œì”!"];

      // ìº¡ì…˜ í…ìŠ¤íŠ¸ ì„¤ì •
      const captionTexts = [
        "ì‹ ì„ í•œ ì¬ë£Œë¡œ ì‹œì‘í•´ìš”",
        "ì •ì„±ìŠ¤ëŸ½ê²Œ ì¤€ë¹„í•©ë‹ˆë‹¤",
        "í‘¹ ë“ì—¬ ê¹Šì€ ë§›ì„ ëƒ…ë‹ˆë‹¤",
        "ì™„ì„±ëœ ìš”ë¦¬ë¥¼ ì¦ê²¨ë³´ì„¸ìš”",
      ];

      // ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ í™”ë©´ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
      async function renderData() {
        try {
          const data = await fetchDataFromDynamoDB();
          const comicGrid = document.getElementById("comicGrid");
          const textContent = document.getElementById("textContent");

          // ë¡œë”© í‘œì‹œ ì œê±°
          comicGrid.innerHTML = "";

          // ì—í”¼ì†Œë“œ ì •ë³´ë¥¼ ì œëª©ì— ì ìš©
          const episodeParts = data.episode.split(":ì§ :");
          document.querySelector(".comic-title").textContent = `${
            data.recommend_id
          } - ${episodeParts[0].substring(0, 20)}...`;

          // ë¯¸ë””ì–´ íŒ¨ë„ ìƒì„±
          data.media_list.forEach((mediaUrl, index) => {
            const panel = document.createElement("div");
            panel.className = "comic-panel";

            // ë¯¸ë””ì–´ íƒ€ì…ì— ë”°ë¼ ì´ë¯¸ì§€ ë˜ëŠ” ë¹„ë””ì˜¤ íƒœê·¸ ìƒì„±
            if (mediaUrl.endsWith(".mp4")) {
              panel.innerHTML = `
                <video controls loop autoplay muted>
                  <source src="${mediaUrl}" type="video/mp4">
                  ë¸Œë¼ìš°ì €ê°€ ë¹„ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </video>
                <div class="speech-bubble panel-${index + 1}-bubble">${
                speechBubbleTexts[index]
              }</div>
                <div class="sound-effect panel-${index + 1}-effect">${
                soundEffectTexts[index]
              }</div>
                <div class="panel-caption">${captionTexts[index]}</div>
              `;
            } else {
              panel.innerHTML = `
                <img src="${mediaUrl}" alt="ë§Œí™” ì»· ${index + 1}">
                <div class="speech-bubble panel-${index + 1}-bubble">${
                speechBubbleTexts[index]
              }</div>
                <div class="sound-effect panel-${index + 1}-effect">${
                soundEffectTexts[index]
              }</div>
                <div class="panel-caption">${captionTexts[index]}</div>
              `;
            }

            comicGrid.appendChild(panel);
          });

          // ì¶”ì²œ ì •ë³´ ë¶„ì„ ë° í‘œì‹œ
          const recommendData = parseRecommendation(data.recommend);

          // í…ìŠ¤íŠ¸ ë‚´ìš© í‘œì‹œ
          textContent.innerHTML = `
            <div class="thought-bubble"></div>
            <h4>ì˜¤ëŠ˜ì˜ ë‹¹ì‹ ì€?</h4>
            <ul>
              <li><strong>í˜„ì¬ ê°ì •</strong>: ${formatEmotions(
                recommendData.emotions
              )}</li>
              <li>
                <strong>ìƒí™©</strong>: 
                <div class="situation-box">
                  ${formatSituation(recommendData.situation, data.persona)}
                </div>
              </li>
            </ul>
            <h4>ì¶”ì²œ ìŒì‹</h4>
            <pre>${recommendData.food}</pre>
            <h4>ì¶”ì²œ ì´ìœ </h4>
            <p>${formatReason(recommendData.reason, data)}</p>
          `;
        } catch (error) {
          // ì˜¤ë¥˜ ì²˜ë¦¬
          const comicGrid = document.getElementById("comicGrid");
          const textContent = document.getElementById("textContent");

          comicGrid.innerHTML =
            '<div class="error-message">ì»·ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
          textContent.innerHTML =
            '<div class="error-message">ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';

          console.error("ë Œë”ë§ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:", error);
        }
      }

      // ì¶”ì²œ ì •ë³´ íŒŒì‹±
      function parseRecommendation(recommendText) {
        // ë§ˆí¬ë‹¤ìš´ ë‚´ìš©ì„ íŒŒì‹±
        const emotionsMatch = recommendText.match(
          /\*\*í˜„ì¬ ê°ì •\*\*:\s*(.*?)(?=\n|-)/
        );
        const situationMatch = recommendText.match(
          /\*\*ìƒí™©\*\*:\s*(.*?)(?=\n|\*\*)/
        );
        const foodMatch = recommendText.match(/```txt\n([\s\S]*?)```/);
        const reasonMatch = recommendText.match(/#### ì¶”ì²œ ì´ìœ \n([\s\S]*?)$/);

        return {
          emotions: emotionsMatch
            ? emotionsMatch[1].trim()
            : "ì„±ì·¨ê°, ì—´ì •, ê¸°ì¨",
          situation: situationMatch
            ? situationMatch[1].trim()
            : "ë™ë£Œë“¤ê³¼ì˜ í† ë¡ ì—ì„œ ì•„ì´ë””ì–´ê°€ ì±„íƒë˜ì–´ ì„±ê³µì ì¸ ìˆœê°„ì„ ê²½í—˜í•¨",
          food: foodMatch
            ? foodMatch[1].trim()
            : "ê³¼í•™ì  í˜¸ê¸°ì‹¬ê³¼ ì˜ˆìˆ ì  ê°ì„±ì´ ê³µì¡´í•˜ëŠ” ë‹¹ì‹ ì—ê²Œ, ì„±ì·¨ì˜ ê¸°ì¨ì„ ë”ìš± í’ì„±í•˜ê²Œ í•´ì¤„ ìƒ‰ê°ì´ í™”ë ¤í•˜ê³  ë‹¤ì–‘í•œ ë§›ì˜ ì¡°í™”ê°€ ë‹ë³´ì´ëŠ” í•œì‹ ìš”ë¦¬",
          reason: reasonMatch
            ? reasonMatch[1].trim()
            : "ì˜¤ëŠ˜ ë‹¹ì‹ ì€ ë§ˆì¹˜ ì™„ë²½í•œ ì»¤í”¼ í•œ ì”ì²˜ëŸ¼ ê· í˜• ì¡íŒ í•˜ë£¨ë¥¼ ë³´ë‚´ì…¨êµ°ìš”!",
        };
      }

      // ê°ì • í‘œì‹œ í˜•ì‹ ì§€ì •
      function formatEmotions(emotions) {
        return emotions
          .split(",")
          .map(
            (emotion) =>
              `<span class="emotion-highlight">${emotion.trim()}</span>`
          )
          .join(" ");
      }

      // ìƒí™© í‘œì‹œ í˜•ì‹ ì§€ì •
      function formatSituation(situation, persona) {
        let situationText = situation;

        // í˜ë¥´ì†Œë‚˜ ì •ë³´ë¥¼ í™œìš©
        if (persona) {
          const personalityTraits = extractPersonalityTraits(persona);
          situationText += ` <span class="emotion-highlight">ì„±ê³µì ì¸ ìˆœê°„</span>ì„ ê²½í—˜í•˜ì…¨êµ°ìš”! ${personalityTraits}`;
        }

        return situationText;
      }

      // í˜ë¥´ì†Œë‚˜ì—ì„œ ì„±ê²© íŠ¹ì„± ì¶”ì¶œ
      function extractPersonalityTraits(persona) {
        // ê°„ë‹¨í•˜ê²Œ ì¶”ì¶œ
        if (persona.includes("ì§€ì ì¸"))
          return "ë‹¹ì‹ ì˜ ì§€ì ì¸ í†µì°°ë ¥ì´ ë¹›ë‚œ ìˆœê°„ì…ë‹ˆë‹¤.";
        if (persona.includes("ì¾Œí™œí•œ"))
          return "ë‹¹ì‹ ì˜ ì¾Œí™œí•œ ì—ë„ˆì§€ê°€ ì£¼ë³€ì„ ë°ê²Œ í–ˆìŠµë‹ˆë‹¤.";
        return "ë‹¹ì‹ ì˜ ì°½ì˜ì ì¸ ìƒê°ì´ ì¸ì •ë°›ì€ íŠ¹ë³„í•œ í•˜ë£¨ì…ë‹ˆë‹¤.";
      }

      // ì¶”ì²œ ì´ìœ  í‘œì‹œ í˜•ì‹ ì§€ì •
      function formatReason(reason, data) {
        let formattedReason = reason;

        // ë‹µë³€ ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ ê°•ì¡°
        if (data.questions && data.questions.length > 0) {
          data.questions.forEach((q) => {
            if (q.answer && formattedReason.includes(q.answer)) {
              formattedReason = formattedReason.replace(
                new RegExp(q.answer, "g"),
                `<span class="emotion-highlight">${q.answer}</span>`
              );
            }
          });
        }

        // ì¤‘ìš” ë‹¨ì–´ë‚˜ ë¬¸êµ¬ ê°•ì¡°
        const keyPhrases = [
          "ì„±ì·¨ê°",
          "ì—´ì •",
          "ê¸°ì¨",
          "ì•„ì´ë””ì–´",
          "ê· í˜•",
          "ì»¤í”¼",
          "ì˜ˆìˆ ì  ê°ì„±",
          "ê³¼í•™ ê¸°ìˆ ",
        ];
        keyPhrases.forEach((phrase) => {
          if (formattedReason.includes(phrase)) {
            formattedReason = formattedReason.replace(
              new RegExp(phrase, "g"),
              `<span class="emotion-highlight">${phrase}</span>`
            );
          }
        });

        return formattedReason;
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë Œë”ë§
      window.addEventListener("DOMContentLoaded", renderData);
    </script>
  </body>
</html>
